{% include "header.html" %}

<div class="wemo-body text-center">

{% for device in devices %}
    <hr>
    <div class="row">
        <div class="col-8 text-left">
            <h2>{{ device.name }}</h2>
        </div>
        <div class="col-4 text-right">
            {% set powered_on = device.is_powered_on() %}

            <label class="switch">
            <input class="powerswitch" device_id="{{ device.id }}" type="checkbox" {% if powered_on %} checked {% endif %} {% if powered_on == None %} disabled {% endif %}>
            <span class="slider round"></span>
            </label>
        </div>
    </div>
    <p>{{ device.description }}  {% if powered_on == None %} - Unable to find device on network {% endif %}</p>


    {% if device.activities %}
    <br>
    <table class="table table-striped">
        <thead>
            <tr>
              <th scope="col-75">Activity Name</th>
              <th scope="col">Time</th>
                <th scope="col"></th>

            </tr>
        </thead>
        <tbody>

            {% for activity in device.activities %}
                <tr>
                    <td>{{ activity.activity_name }}</td>
                    <td>{{ activity.activity_time }}</td>
                    <td><a href="{{ url_for('activity.edit_activity', activity_id=activity.id) }}"><button class="btn btn-primary">Edit</button></a></td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p> No activities for outlet </p>
    {% endif %}

    <a href="{{ url_for('activity.add_activity', device_id = device.id) }}"><button class="btn wide-button btn-primary">Add a new activity</button></a>
    <br><br><br>
{% endfor %}


</div>

<script>
    $(document).ready(function() {
        $(".powerswitch").each(function(index){

            $(this).click(function(){
                console.log('click detected for ' + $(this).attr('device_id') + ' checked? ' + $(this).checked);
                var qurl="{{ url_for('index.changestatus') }}";
                $.ajax({
                        type: "POST",
                        cache: false,
                        data: { 'desired_status' : ($(this).prop('checked') ? 1 : 0),
                                'device': $(this).attr('device_id')},
                        url: qurl,
                        dataType: "json"
                 });
             });
         });
    });
</script>

{% include "footer.html" %}